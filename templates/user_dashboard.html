{% extends "base.html" %}
{% block content %}
<h2>Your Tickets</h2>

<h3>Ticket Overview</h3>
<div style="width: 600px; height: 600px; margin: 0 auto;">
  <canvas id="ticketChart"></canvas>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
const ctx = document.getElementById('ticketChart').getContext('2d');
new Chart(ctx, {
  type: 'pie',
  data: {
    labels: {{ status_labels|tojson }},
    datasets: [{
      label: 'Tickets by Status',
      data: {{ status_counts|tojson }},
      backgroundColor: ['#36A2EB', '#FFCE56', '#FF6384', '#4BC0C0'],
      borderColor: '#fff',
      borderWidth: 2
    }]
  },
  options: {
    plugins: {
      legend: {
        position: 'bottom',
        labels: { font: { size: 16 } }
      },
      title: {
        display: true,
        text: 'Ticket Status Distribution',
        font: { size: 20 }
      }
    }
  }
});
</script>


{% if tickets %}
  <table class="table table-striped">
    <thead>
      <tr>
        <th>ID</th>
        <th>Subject</th>
        <th>Category</th>
        <th>Priority</th>
        <th>Status</th>
        <th>Created</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      {% for ticket in tickets %}
      <tr>
        <td>{{ ticket.id }}</td>
        <td>{{ ticket.subject }}</td>
        <td>{{ ticket.category }}</td>
        <td>{{ ticket.priority }}</td>
        <td>{{ ticket.status }}</td>
        <td>{{ ticket.created_at.strftime("%Y-%m-%d %H:%M") }}</td>
        <td>
          <a href="{{ url_for('view_ticket', ticket_id=ticket.id) }}" class="btn btn-sm btn-info">View</a>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
{% else %}
  <p>No tickets yet.</p>
{% endif %}

<a href="{{ url_for('create_ticket') }}" class="btn btn-primary">Create New Ticket</a>
{% endblock %}

